# Detection


## Introduction

Detectors are a higher level analysis functions that run on top of processors to get a more curated and specific results. In essence, any function that utilize and analyse the tokens, POS tags, and/or dependencies can be considered a detector.

## Examples

The following examples demonstrate how you can actually utilize the processors results to write detectors. Those examples are by no means real world ready, but they do give you a good understanding of how to write detectors.

### Common misspellings

In this example, imagine we have 1000s of scientific literature. and although it's peer-reviewed, it's still manmade and still prone to misspellings.

An experiment we're set to do is to detect all the misspellings and see what's the most common misspelling we have.

```javascript
const Fin = require("finnlp").Fin;

const possible = [
    /* ---- */
    /* Imagine this array being a full list */
    /* of all the possible english words */
    /* and scientific terms */
    /* ---- */
];

const misspellings = {};

Fin.addDetector(function(result){
    result.tokens.forEach((sentenceLevel,sentenceIndx)=>{
        sentenceLevel.forEach((token)=>{
            if(possible.indexOf(token) === -1) {
                if(!misspellings[token]) misspellings[token] = 0;
                misspellings[token]++;
            }
        });
    });
});

// run it
Fin.run("a string of 1000s of literature");

// log it
console.log(misspellings);

```

### Car brands

Let's say that we have a 100MB file of tweets. Each tweet can be considered as a sentence. We want to mine this data file to get an understanding of the most loved/hated german car brands.

- Audi
- BMW
- Opel

__Rules__

- If a brand described as: worthy, good, excellent, fast, or great, then we add (1) to that brand score.
- If a brand is an object of the the following verbs: love, like, adore, admire the we add (1) to that brand score.
- If a brand is described as: unworthy, bad, slow, poor, then we substract (1) from that brand score.
- If a brand is an object of the following verbs: dislike, hate, despise, scorn, then we substract (1) from that brand score.

Enough talk, Let's write the code:

```javascript
const Fin = require("finnlp").Fin;

const positiveAdjectives = ["good","excellent","fast","great","worthy"];
const negativeAdjectives = ["poor","cheap","slow","bad"];
const positiveVerbs = ["love","like","adore","admire"];
const negativeVerbs = ["dislike","hate","despise","scorn"];

const scores = {
  bmw:0,
  opel:0,
  audi:0,
}

Fin.addDetector(function(result){
  result.tokens.forEach((sentenceLevel,sentenceIndx)=>{
    sentenceLevel.forEach((token,tokenIndx)=>{
      token = token.toLowerCase();
      // check if the token is a german car brand:
      if(token === "bmw" || token === "audi" || token === "opel") {
        // now first let's check it's children
        // and see if it's being described
        // as something of interest:
        result.deps[sentenceIndx].forEach((node,nodeIndx)=>{
          if(node.parent === tokenIndx) {
            const childToken = input.tokens[sentenceIndx][nodeIndx].toLowerCase();
            if(positiveAdjectives.indexOf(childToken) > -1) {
              scores[token]++
            }
            if(negativeAdjectives.indexOf(childToken) > -1){
              scores[token]--
            }
          }
        });

        // Next we'll check if the brand is mentioned
        // in the sentence as an object
        // and if it's an object for a verb of interest
        const brandLabel = result.deps[sentenceIndx][tokenIndx].label;
        const brandParentIndx = result.deps[sentenceIndx][tokenIndx].parent;
        const brandParentToken = result.tokens[sentenceIndx][brandParentIndx].toLowerCase();
        if(brandLabel.endsWith("OBJ")) {
          if(positiveVerbs.indexOf(brandParentToken) > -1) {
            scores[token]++;
          }
          if(negativeVerbs.indexOf(brandParentToken) > -1) {
            scores[token]--;
          }
        }
      }
    });
  })
});


// now lets run the processors,
// and the detectors will be automatically called
Fin.run("huge amount of text");


// and console.log the results
console.log(scores);
```


> __HINT__
> In real world cases, you may also want to check adverbs that have negative or positive sentiments for a verb that the brand is an object of. You must also check if the positive or negative keyword is negated and more checks are possible.
>


> __HINT__
> To write a good and sensitive detector, you would have a list of example sentences that are for example describing brands and then you try to extract the relationship between the negative/positive keyword and the brand.